name: Check JSON files

on:
  pull_request:
    paths:
      - 'ModConfigs/**/*.json'
      - '!**/lang/**/*.json'

jobs:
  json_check:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14.x'
    - name: Install dependencies
      run: npm install -g ajv-cli
    - name: Check JSON files
      run: |
        npx jsonlint -q ModConfigs/**/*.json
        for f in $(git diff --name-only origin/main ${{ github.event.pull_request.head.sha }} --diff-filter=AM -- 'ModConfigs/**/*.json' -- ':!:ModConfigs/lang/**/*.json'); do
          if ! grep -q '"mods"\|mods\|desc\|name\|authors' "$f"; then
            echo "The file $f does not contain the required parameters."
            exit 1
          fi
        done